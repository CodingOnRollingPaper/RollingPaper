<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Paper</title>
    <link rel="stylesheet" href="/static/css/reset.css" />
    <link rel="stylesheet" href="/static/css/common.css" />
    <link rel="stylesheet" href="/static/css/paper.css" />
    <link rel="stylesheet" href="/static/css/snow.css" />
    <!-- axios cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div id="wrap">
      <div id="header">     
        <% if (userSession) { %>
        <form action="/logout" method="post">
          <div class="logout">
            <button style="color: white">LogOut</button>
          </div>
        </form>
        <% } %>
        <canvas id="canvas"> </canvas>

        <h1><%= userName %>ë‹˜ì—ê²Œ ì˜¨ ë§ˆìŒ</h1>
        <div class="userId"><%= userId %></div>
        <!-- class='userId' display none ì²˜ë¦¬ ë¶€íƒí•©ë‹ˆë‹¤. => ì™„ë£Œ -->
      </div>
      <!-- í¸ì§€ ëª©ë¡ -->
      <div class="postArea">
        <% for (let i = 0; i < data.length; i++) { %>
        <div class="postContainer">
          <div class="postBox textArea">
            <div class="postId">ğŸ“© No. <%= data[i].dataValues.postId %></div>
            <div class="postContent"><%= data[i].dataValues.postContent %></div>
          </div>
        </div>
        <% } %>
      </div>

      <!-- í¸ì§€ ë””í…Œì¼ ëª¨ë‹¬ì°½ -->
      <% for (let i = 0; i < data.length; i++) { %>
      <div
        class="postContainerDetail noshow Id<%= data[i].dataValues.postId %>"
      >
        <div>
          <div class="closeDetail">X</div>
        </div>
        <div class="postBoxDetail">
          <div class="postIdDetail">
            ğŸ“© No. <%= data[i].dataValues.postId %> ë²ˆì§¸ ë§ˆìŒ
          </div>
          <div
            class="postContentDetail Content<%= data[i].dataValues.postId %>"
          >
            <%= data[i].dataValues.postContent %>

     
            </div>
          </div>
          <div class="postBtn id<%= data[i].dataValues.postId %>">
            <button onclick="editBtn('<%= data[i].dataValues.postId %>')">
              ìˆ˜ì •
            </button>
            <button onclick="deleteBtn()">ì‚­ì œ</button>

          </div>
        </div>

      

      <div class="postBtn id<%= data[i].dataValues.postId %>"></div>
      <% } %>

      <!-- í¸ì§€ ì‘ì„± ëª¨ë‹¬ì°½ -->
      <div class="writeContent noshow">
        <div class="close" onclick="show()">
          <div>X</div>
        </div>
        <div class="writeArea">
          ë‚¨ê¸°ê³  ì‹¶ì€ ë§
          <textarea
            class="submitContent"
            type="text"
            name="post"
            placeholder="ì „í•˜ê³  ì‹¶ì€ ë©”ì„¸ì§€ë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”"
            required
          ></textarea>
          PASSWORD
          <input
            class="submitPw"
            type="password"
            name="postPw"
            placeholder="ê¸€ ìˆ˜ì •, ì‚­ì œì‹œ í•„ìš”í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ 30ì ì´í•˜ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”"
            required
          />
          <button class="submitGo" onclick="createPost()">ì…ë ¥</button>
        </div>
      </div>

      <!-- í¸ì§€ ì‘ì„± ëª¨ë‹¬ ë„ìš°ëŠ” ì´ë¯¸ì§€ ë²„íŠ¼ -->
      <div class="writeImg" onclick="show()">
        <img src="/static/img/writing.png" alt="ì‘ì„±í•˜ê¸°" />
      </div>
    </div>
    <script>
      let submitGo = document.querySelector(".submitGo");
      let submitContent = document.querySelector(".submitContent");
      let submitPw = document.querySelector(".submitPw");
      let userId = document.querySelector(".userId").textContent;

      const createPost = () => {
        // ë¹ˆê°’ ìœ íš¨ì„± ê²€ì‚¬
        if (!submitContent.checkValidity()) {
          return submitContent.focus();
        } else if (!submitPw.checkValidity()) {
          return submitPw.focus();
        }
        console.log(submitContent.value, submitPw.value);
        axios({
          method: "post",
          url: "/post/create",
          data: {
            userId: userId,
            postContent: submitContent.value,
            postPw: submitPw.value,
          },
        }).then((res) => {
          //let contentBox = `<div class="postContainer">
          // <div class="postId">ê²Œì‹œ ë²ˆí˜¸ ${res.data.postId}</div>
          //  <div class="postContent">${res.data.postContent}</div>
          // <div class="postBtn id${res.data.postId}">
          //   <button onclick="editBtn(${res.data.postId})">ìˆ˜ì •</button>
          //  <button>ì‚­ì œ</button>
          // </div>
          window.location.reload();
        });
        submitContent.value = "";
        submitPw.value = "";
        writeContent.classList.add("noshow");
        postArea.classList.remove("noshow");
      };


      // let postBtn = document.querySelector(".postBtn");

      // let postContent = document.querySelector(".postContent");
      //  let postBtn = document.querySelector(".postBtn");
      // let postContainerDetail = document.querySelector(".postContainerDetail");
      let postBoxDetail = document.querySelector(".postBoxDetail");
      const editBtn = async (id) => {
        let postNum = document.querySelector(`.id${id}`);
        console.log(id);
        console.log(postNum);
        console.log(postBtn);
        console.log("edit!");
        // const editBox = `
        //     <input class="editPw" type="password" name="editPw">
        //     <button onclick="editPwCheck()">PW í™•ì¸</button>
        //  `;
        //  postNum.innerHTML = editBox;
        const editBox = `<div class="postContent">${postContainerDetail.value}</div>
          <div class="postBtn">
            <textarea class="editPw" type="password" name="editPw"></textarea>
            <button onclick="editPost()">ìˆ˜ì •</button>
          </div>`;
        postBoxDetail.innerHTML = editBox;

        // let result = await axios({
        //   method: "GET",
        //   url: '/post/editPwCheck',
        // }).then((res) => {
        //   console.log("editBtn res", res.data);
        //   return res.data;
        // });
      };

      const editPwCheck = (id) => {
        let editPw = document.querySelector(".editPw");
        let postNum = document.querySelector(`.id${id}`);
        console.log(editPw.value);
        axios({
          method: "POST",
          url: "/post/editPwCheck",
          data: {
            postPw: editPw.value,
          },
        })
          .then((res) => {
            console.log(res.data);
            console.log("ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€");
          })
          .then((data) => {
            // console.log(data);
          });
      };

      const deleteBtn = () => {
        console.log("delete!");
      };
    </script>
    <script src="/static/js/paper.js"></script>
    <script src="/static/js/snow.js"></script>
  </body>
</html>
