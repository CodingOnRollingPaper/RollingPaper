<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Paper</title>
    <link rel="stylesheet" href="/static/css/reset.css" />
    <link rel="stylesheet" href="/static/css/common.css" />
    <link rel="stylesheet" href="/static/css/paper.css" />
    <!-- axios cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>

    <div id="wrap">
      <div id="header">
        <h1><%= userName %>님에게 온 마음</h1>
        <div class="userId"><%= userId %></div>
        <!-- class='userId' display none 처리 부탁합니다. => 완료 -->
      </div>

      <!-- <div class="postArea noshow"></div> -->

    <div class="postArea">
      <% if (isPost) { %> <% for (let i = 0; i < data.length; i++) { %>
      <div class="postContainer">
        <div class="postBox">
          <div class="postId">게시 번호 <%= data[i].dataValues.postId %></div>
          <div class="postContent"><%= data[i].dataValues.postContent %></div>
          <div class="postBtn">
            <button onclick="editBtn()">수정</button>
            <button onclick="deleteBtn()">삭제</button>
          </div>
        </div>
      </div>
      <% } %> <% } %>
    </div>
    <% if(userSession && userSession.userId == userId){%>
    <button>공유하기</button>
    <% } else { %> 
    <div class="postContentModal noshow"></div>

      <div class="writeContent noshow">
        <div class="close" onclick="show()">
          <div>X</div>
        </div>
        <div class="writeArea">
          남기고 싶은 말
          <textarea
            class="submitContent"
            type="text"
            name="post"
            placeholder="전하고 싶은 메세지를 작성해 주세요"
            required
          ></textarea>
          비밀번호
          <input
            class="submitPw"
            type="password"
            name="postPw"
            placeholder="30자 이하로 작성해 주세요"
            required
          />
          <button class="submitGo" onclick="createPost()">입력</button>
        </div>
      </div>
      <div class="writeImg" onclick="show()">
        <img src="/static/img/writing.png" alt="작성하기" />
      </div>
    </div>
    <% } %>


    <script>
      let submitGo = document.querySelector(".submitGo");
      let submitContent = document.querySelector(".submitContent");
      let submitPw = document.querySelector(".submitPw");
      let userId = document.querySelector(".userId").textContent;

      const createPost = () => {
        // 유효성 검사
        if (!submitContent.checkValidity()) {
          return submitContent.focus();
        } else if (!submitPw.checkValidity()) {
          return submitPw.focus();
        }
        console.log(submitContent.value, submitPw.value);
        axios({
          method: "post",
          url: "/post/create",
          data: {
            userId: userId,
            postContent: submitContent.value,
            postPw: submitPw.value,
          },
        }).then((res) => {

          let contentBox = `<div class="postContainer textArea" onclick="postModal()">
              <div class="postId"> 📩 No. ${res.data.postId}</div>
              <div class="postContent">${res.data.postContent}</div>
          </div>`;
          document
            .querySelector(".postArea")
            .insertAdjacentHTML("beforeend", contentBox);
        });
        submitContent.value = "";
        submitPw.value = "";
        writeContent.classList.add("noshow");
        postArea.classList.remove("noshow");
      };

      let postContent = document.querySelector(".postContent");
      let postBox = document.querySelector(".postBox");
      const editBtn = async (id) => {
        console.log("edit!");
        const editBox = `<div class="postContent">${postContent.value}</div>
          <div class="postBtn">
            <input class="editPw" type="password" name="editPw">
            <button onclick="editPost()">수정</button>
          </div>`;
        postBox.innerHTML = editBox;

        let result = await axios({
          method: "GET",
          url: `/paper/<%= userId %>/<%= userName %>/get?id=${id}`,
        }).then((res) => {
          console.log("editBtn res", res.data);
          return res.data;
        });
      };

      const deleteBtn = () => {
        console.log("delete!");
      };
    </script>
    <script src="/static/js/paper.js"></script>
  </body>
</html>
